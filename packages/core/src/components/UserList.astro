---
import type { UserQueryResult } from '../types/user';
import { Link, Button, Container } from '@coffic/cosy-ui';

export interface Props {
    users: UserQueryResult;
    usernameFilter?: string;
    roleFilter?: string;
    limit: number;
}

const { users, usernameFilter, roleFilter, limit } = Astro.props;
---

<Container width="full" background="warning/10" flex="col" gap="md">
    <h2>用户列表</h2>
    <p>
        显示第 {users.pagination.page} 页，共 {users.pagination.totalPages} 页，总计
        {users.pagination.total} 条记录
    </p>

    <table class="users-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>用户名</th>
                <th>邮箱</th>
                <th>角色</th>
                <th>状态</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {
                users.data.map((user) => (
                    <tr>
                        <td>{user.id}</td>
                        <td class="username-cell" title={user.username}>
                            {user.username}
                        </td>
                        <td title={user.email}>{user.email}</td>
                        <td>
                            <span class="role-tag">{user.role}</span>
                        </td>
                        <td>
                            <span>{user.is_active ? '激活' : '未激活'}</span>
                        </td>
                        <td>
                            {new Date(user.created_at).toLocaleString('zh-CN')}
                        </td>
                        <td>
                            <Link btn size="sm" href={`/users/${user.id}/edit`}>
                                编辑
                            </Link>
                            <Button
                                size="sm"
                                data-action="delete"
                                data-id={user.id}>
                                删除
                            </Button>
                        </td>
                    </tr>
                ))
            }
        </tbody>
    </table>

    <!-- 分页 -->
    <Container background="error/10" contentCentered>
        {
            users.pagination.page > 1 && (
                <Link
                    href={`/users?page=${users.pagination.page - 1}&limit=${limit}${usernameFilter ? `&username=${encodeURIComponent(usernameFilter)}` : ''}${roleFilter ? `&role=${encodeURIComponent(roleFilter)}` : ''}`}>
                    ← 上一页
                </Link>
            )
        }

        <span>
            第 {users.pagination.page} 页，共 {users.pagination.totalPages} 页
        </span>

        {
            users.pagination.page < users.pagination.totalPages && (
                <a
                    href={`/users?page=${users.pagination.page + 1}&limit=${limit}${usernameFilter ? `&username=${encodeURIComponent(usernameFilter)}` : ''}${roleFilter ? `&role=${encodeURIComponent(roleFilter)}` : ''}`}>
                    下一页 →
                </a>
            )
        }
    </Container>
</Container>

<style>
    .users-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .users-table th,
    .users-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }

    .users-table th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #374151;
    }

    .users-table tr:hover {
        background-color: #f9fafb;
    }

    .username-cell {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>
