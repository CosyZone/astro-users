---
import { UsersQuery } from '@coffic/astro-users';
import AppLayout from '../layout/AppLayout.astro';

const usersQuery = new UsersQuery(Astro.locals);

// 测试创建用户
const testUser = await usersQuery.createUser({
    username: 'testuser',
    email: 'test@example.com',
    password: 'testpassword',
    first_name: 'Test',
    last_name: 'User',
    role: 'user',
    is_active: true,
});

// 测试获取用户
const users = await usersQuery.getUsers({
    page: 1,
    limit: 10,
});

// 测试获取统计
const stats = await usersQuery.getStats();
---

<AppLayout
    showSidebar={false}
    py="5xl"
    title="用户管理测试"
    description="测试用户管理功能">
    <div class="container">
        <h1>用户管理功能测试</h1>

        <h2>创建用户测试</h2>
        {
            testUser ? (
                <div class="success">
                    <p>✅ 用户创建成功!</p>
                    <pre>{JSON.stringify(testUser, null, 2)}</pre>
                </div>
            ) : (
                <div class="error">
                    <p>❌ 用户创建失败</p>
                </div>
            )
        }

        <h2>用户列表测试</h2>
        <div class="users-list">
            <p>总共找到 {users.pagination.total} 个用户</p>
            <ul>
                {
                    users.data.map((user) => (
                        <li key={user.id}>
                            {user.username} ({user.email}) - {user.role}
                        </li>
                    ))
                }
            </ul>
        </div>

        <h2>统计信息测试</h2>
        <div class="stats">
            <p>总用户数: {stats.totalUsers}</p>
            <p>活跃用户数: {stats.activeUsers}</p>
            <p>今日新增用户数: {stats.todayUsers}</p>
            <h3>角色统计:</h3>
            <ul>
                {
                    stats.roles.map((roleStat) => (
                        <li key={roleStat.role}>
                            {roleStat.role}: {roleStat.count} 个用户
                        </li>
                    ))
                }
            </ul>
        </div>
    </div>

    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }

        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
    </style>
</AppLayout>
